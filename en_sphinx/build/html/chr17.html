<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chapter 17 Graphics including GenomeDiagram &mdash; biopython_en 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="biopython_en 0.1 documentation" href="index.html" />
    <link rel="next" title="Chapter 18 Cookbook – Cool things to do with it" href="chr18.html" />
    <link rel="prev" title="Chapter 16 Supervised learning methods" href="chr16.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="chr18.html" title="Chapter 18 Cookbook – Cool things to do with it"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="chr16.html" title="Chapter 16 Supervised learning methods"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">biopython_en 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="chapter-17-graphics-including-genomediagram">
<h1>Chapter 17  Graphics including GenomeDiagram<a class="headerlink" href="#chapter-17-graphics-including-genomediagram" title="Permalink to this headline">¶</a></h1>
<p>The <tt class="docutils literal"><span class="pre">Bio.Graphics</span></tt> module depends on the third party Python library
<a class="reference external" href="http://www.reportlab.org">ReportLab</a>. Although focused on producing
PDF files, ReportLab can also create encapsulated postscript (EPS) and
(SVG) files. In addition to these vector based images, provided certain
further dependencies such as the <a class="reference external" href="http://www.pythonware.com/products/pil/">Python Imaging Library
(PIL)</a> are installed,
ReportLab can also output bitmap images (including JPEG, PNG, GIF, BMP
and PICT formats).</p>
<div class="section" id="genomediagram">
<h2>17.1  GenomeDiagram<a class="headerlink" href="#genomediagram" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>17.1.1  Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">Bio.Graphics.GenomeDiagram</span></tt> module was added to Biopython 1.50,
having previously been available as a separate Python module dependent
on Biopython. GenomeDiagram is described in the Bioinformatics journal
publication by Pritchard et al. (2006) [<a class="reference external" href="#pritchard2006">2</a>], which
includes some examples images. There is a PDF copy of the old manual
here,
<a class="reference external" href="http://biopython.org/DIST/docs/GenomeDiagram/userguide.pdf">http://biopython.org/DIST/docs/GenomeDiagram/userguide.pdf</a>
which has some more examples. As the name might suggest, GenomeDiagram
was designed for drawing whole genomes, in particular prokaryotic
genomes, either as linear diagrams (optionally broken up into fragments
to fit better) or as circular wheel diagrams. Have a look at Figure 2 in
Toth <em>et al.</em> (2006) [<a class="reference external" href="#toth2006">3</a>] for a good example. It proved
also well suited to drawing quite detailed figures for smaller genomes
such as phage, plasmids or mitochrondia, for example see Figures 1 and 2
in Van der Auwera <em>et al.</em> (2009) [<a class="reference external" href="#vanderauwera2009">4</a>] (shown
with additional manual editing).</p>
<p>This module is easiest to use if you have your genome loaded as a
<tt class="docutils literal"><span class="pre">SeqRecord</span></tt> object containing lots of <tt class="docutils literal"><span class="pre">SeqFeature</span></tt> objects - for
example as loaded from a GenBank file (see
Chapters <a class="reference external" href="#chapter:SeqRecord">4</a> and <a class="reference external" href="#chapter:Bio.SeqIO">5</a>).</p>
</div>
<div class="section" id="diagrams-tracks-feature-sets-and-features">
<h3>17.1.2  Diagrams, tracks, feature-sets and features<a class="headerlink" href="#diagrams-tracks-feature-sets-and-features" title="Permalink to this headline">¶</a></h3>
<p>GenomeDiagram uses a nested set of objects. At the top level, you have a
diagram object representing a sequence (or sequence region) along the
horizontal axis (or circle). A diagram can contain one or more tracks,
shown stacked vertically (or radially on circular diagrams). These will
typically all have the same length and represent the same sequence
region. You might use one track to show the gene locations, another to
show regulatory regions, and a third track to show the GC percentage.
The most commonly used type of track will contain features, bundled
together in feature-sets. You might choose to use one feature-set for
all your CDS features, and another for tRNA features. This isn’t
required - they can all go in the same feature-set, but it makes it
easier to update the properties of just selected features (e.g. make all
the tRNA features red).</p>
<p>There are two main ways to build up a complete diagram. Firstly, the top
down approach where you create a diagram object, and then using its
methods add track(s), and use the track methods to add feature-set(s),
and use their methods to add the features. Secondly, you can create the
individual objects separately (in whatever order suits your code), and
then combine them.</p>
</div>
<div class="section" id="a-top-down-example">
<h3>17.1.3  A top down example<a class="headerlink" href="#a-top-down-example" title="Permalink to this headline">¶</a></h3>
<p>We’re going to draw a whole genome from a <tt class="docutils literal"><span class="pre">SeqRecord</span></tt> object read in
from a GenBank file (see Chapter <a class="reference external" href="#chapter:Bio.SeqIO">5</a>). This
example uses the pPCP1 plasmid from <em>Yersinia pestis biovar Microtus</em>,
the file is included with the Biopython unit tests under the GenBank
folder, or online
<a class="reference external" href="http://biopython.org/SRC/biopython/Tests/GenBank/NC_005816.gb">NC_005816.gb</a>
from our website.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">reportlab.lib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">reportlab.lib.units</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">Bio.Graphics</span> <span class="kn">import</span> <span class="n">GenomeDiagram</span>
<span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
<span class="n">record</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;NC_005816.gb&quot;</span><span class="p">,</span> <span class="s">&quot;genbank&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We’re using a top down approach, so after loading in our sequence we
next create an empty diagram, then add an (empty) track, and to that add
an (empty) feature set:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">gd_diagram</span> <span class="o">=</span> <span class="n">GenomeDiagram</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="s">&quot;Yersinia pestis biovar Microtus plasmid pPCP1&quot;</span><span class="p">)</span>
<span class="n">gd_track_for_features</span> <span class="o">=</span> <span class="n">gd_diagram</span><span class="o">.</span><span class="n">new_track</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Annotated Features&quot;</span><span class="p">)</span>
<span class="n">gd_feature_set</span> <span class="o">=</span> <span class="n">gd_track_for_features</span><span class="o">.</span><span class="n">new_set</span><span class="p">()</span>
</pre></div>
</div>
<p>Now the fun part - we take each gene <tt class="docutils literal"><span class="pre">SeqFeature</span></tt> object in our
<tt class="docutils literal"><span class="pre">SeqRecord</span></tt>, and use it to generate a feature on the diagram. We’re
going to color them blue, alternating between a dark blue and a light
blue.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s">&quot;gene&quot;</span><span class="p">:</span>
        <span class="c">#Exclude this feature</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gd_feature_set</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">blue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightblue</span>
    <span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we come to actually making the output file. This happens in two
steps, first we call the <tt class="docutils literal"><span class="pre">draw</span></tt> method, which creates all the shapes
using ReportLab objects. Then we call the <tt class="docutils literal"><span class="pre">write</span></tt> method which renders
these to the requested file format. Note you can output in multiple file
formats:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">gd_diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&quot;linear&quot;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&quot;landscape&quot;</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="s">&#39;A4&#39;</span><span class="p">,</span>
                <span class="n">fragments</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">))</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_linear.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;PDF&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_linear.eps&quot;</span><span class="p">,</span> <span class="s">&quot;EPS&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_linear.svg&quot;</span><span class="p">,</span> <span class="s">&quot;SVG&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Also, provided you have the dependencies installed, you can also do
bitmaps, for example:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_linear.png&quot;</span><span class="p">,</span> <span class="s">&quot;PNG&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image13" src="_images/plasmid_linear.png" /></p>
<p>Notice that the <tt class="docutils literal"><span class="pre">fragments</span></tt> argument which we set to four controls how
many pieces the genome gets broken up into.</p>
<p>If you want to do a circular figure, then try this:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">gd_diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&quot;circular&quot;</span><span class="p">,</span> <span class="n">circular</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">),</span>
                <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">circle_core</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_circular.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;PDF&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image14" src="_images/plasmid_circular.png" /></p>
<p>These figures are not very exciting, but we’ve only just got started.</p>
</div>
<div class="section" id="a-bottom-up-example">
<h3>17.1.4  A bottom up example<a class="headerlink" href="#a-bottom-up-example" title="Permalink to this headline">¶</a></h3>
<p>Now let’s produce exactly the same figures, but using the bottom up
approach. This means we create the different objects directly (and this
can be done in almost any order) and then combine them.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">reportlab.lib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">reportlab.lib.units</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">Bio.Graphics</span> <span class="kn">import</span> <span class="n">GenomeDiagram</span>
<span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
<span class="n">record</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;NC_005816.gb&quot;</span><span class="p">,</span> <span class="s">&quot;genbank&quot;</span><span class="p">)</span>

<span class="c">#Create the feature set and its feature objects,</span>
<span class="n">gd_feature_set</span> <span class="o">=</span> <span class="n">GenomeDiagram</span><span class="o">.</span><span class="n">FeatureSet</span><span class="p">()</span>
<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s">&quot;gene&quot;</span><span class="p">:</span>
        <span class="c">#Exclude this feature</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gd_feature_set</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">blue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightblue</span>
    <span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c">#(this for loop is the same as in the previous example)</span>

<span class="c">#Create a track, and a diagram</span>
<span class="n">gd_track_for_features</span> <span class="o">=</span> <span class="n">GenomeDiagram</span><span class="o">.</span><span class="n">Track</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Annotated Features&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span> <span class="o">=</span> <span class="n">GenomeDiagram</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="s">&quot;Yersinia pestis biovar Microtus plasmid pPCP1&quot;</span><span class="p">)</span>

<span class="c">#Now have to glue the bits together...</span>
<span class="n">gd_track_for_features</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">gd_feature_set</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">add_track</span><span class="p">(</span><span class="n">gd_track_for_features</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now call the <tt class="docutils literal"><span class="pre">draw</span></tt> and <tt class="docutils literal"><span class="pre">write</span></tt> methods as before to produce
a linear or circular diagram, using the code at the end of the top-down
example above. The figures should be identical.</p>
</div>
<div class="section" id="features-without-a-seqfeature">
<h3>17.1.5  Features without a SeqFeature<a class="headerlink" href="#features-without-a-seqfeature" title="Permalink to this headline">¶</a></h3>
<p>In the above example we used a <tt class="docutils literal"><span class="pre">SeqRecord</span></tt>’s <tt class="docutils literal"><span class="pre">SeqFeature</span></tt> objects
to build our diagram (see also Section <a class="reference external" href="#sec:seq_features">4.3</a>).
Sometimes you won’t have <tt class="docutils literal"><span class="pre">SeqFeature</span></tt> objects, but just the
coordinates for a feature you want to draw. You have to create minimal
<tt class="docutils literal"><span class="pre">SeqFeature</span></tt> object, but this is easy:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio.SeqFeature</span> <span class="kn">import</span> <span class="n">SeqFeature</span><span class="p">,</span> <span class="n">FeatureLocation</span>
<span class="n">my_seq_feature</span> <span class="o">=</span> <span class="n">SeqFeature</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="n">strand</span><span class="o">=+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>For strand, use <tt class="docutils literal"><span class="pre">+1</span></tt> for the forward strand, <tt class="docutils literal"><span class="pre">-1</span></tt> for the reverse
strand, and <tt class="docutils literal"><span class="pre">None</span></tt> for both. Here is a short self contained example:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio.SeqFeature</span> <span class="kn">import</span> <span class="n">SeqFeature</span><span class="p">,</span> <span class="n">FeatureLocation</span>
<span class="kn">from</span> <span class="nn">Bio.Graphics</span> <span class="kn">import</span> <span class="n">GenomeDiagram</span>
<span class="kn">from</span> <span class="nn">reportlab.lib.units</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="n">gdd</span> <span class="o">=</span> <span class="n">GenomeDiagram</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="s">&#39;Test Diagram&#39;</span><span class="p">)</span>
<span class="n">gdt_features</span> <span class="o">=</span> <span class="n">gdd</span><span class="o">.</span><span class="n">new_track</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">greytrack</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">gds_features</span> <span class="o">=</span> <span class="n">gdt_features</span><span class="o">.</span><span class="n">new_set</span><span class="p">()</span>

<span class="c">#Add three features to show the strand options,</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">SeqFeature</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">125</span><span class="p">),</span> <span class="n">strand</span><span class="o">=+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gds_features</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Forward&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">SeqFeature</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="n">strand</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">gds_features</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Strandless&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">SeqFeature</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="mi">275</span><span class="p">,</span> <span class="mi">375</span><span class="p">),</span> <span class="n">strand</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gds_features</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Reverse&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">gdd</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">cm</span><span class="p">),</span> <span class="n">fragments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
         <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">gdd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;GD_labels_default.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The top part of the image in the next subsection shows the output (in
the default feature color, pale green).</p>
<p>Notice that we have used the <tt class="docutils literal"><span class="pre">name</span></tt> argument here to specify the
caption text for these features. This is discussed in more detail next.</p>
</div>
<div class="section" id="feature-captions">
<h3>17.1.6  Feature captions<a class="headerlink" href="#feature-captions" title="Permalink to this headline">¶</a></h3>
<p>Recall we used the following (where <tt class="docutils literal"><span class="pre">feature</span></tt> was a <tt class="docutils literal"><span class="pre">SeqFeature</span></tt>
object) to add a feature to the diagram:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>In the example above the <tt class="docutils literal"><span class="pre">SeqFeature</span></tt> annotation was used to pick a
sensible caption for the features. By default the following possible
entries under the <tt class="docutils literal"><span class="pre">SeqFeature</span></tt> object’s qualifiers dictionary are
used: <tt class="docutils literal"><span class="pre">gene</span></tt>, <tt class="docutils literal"><span class="pre">label</span></tt>, <tt class="docutils literal"><span class="pre">name</span></tt>, <tt class="docutils literal"><span class="pre">locus_tag</span></tt>, and <tt class="docutils literal"><span class="pre">product</span></tt>.
More simply, you can specify a name directly:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;My Gene&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition to the caption text for each feature’s label, you can also
choose the font, position (this defaults to the start of the sigil, you
can also choose the middle or at the end) and orientation (for linear
diagrams only, where this defaults to rotated by 45 degrees):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Large font, parallel with the track</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">,</span>
                           <span class="n">label_size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">label_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c">#Very small font, perpendicular to the track (towards it)</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;purple&quot;</span><span class="p">,</span>
                           <span class="n">label_position</span><span class="o">=</span><span class="s">&quot;end&quot;</span><span class="p">,</span>
                           <span class="n">label_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label_angle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="c">#Small font, perpendicular to the track (away from it)</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span>
                           <span class="n">label_position</span><span class="o">=</span><span class="s">&quot;middle&quot;</span><span class="p">,</span>
                           <span class="n">label_size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label_angle</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
<p>Combining each of these three fragments with the complete example in the
previous section should give something like this:</p>
<p><img alt="image15" src="_images/GD_sigil_labels.png" /></p>
<p>We’ve not shown it here, but you can also set <tt class="docutils literal"><span class="pre">label_color</span></tt> to control
the label’s color (used in Section <a class="reference external" href="#sec:gd_nice_example">17.1.9</a>).</p>
<p>You’ll notice the default font is quite small - this makes sense because
you will usually be drawing many (small) features on a page, not just a
few large ones as shown here.</p>
</div>
<div class="section" id="feature-sigils">
<h3>17.1.7  Feature sigils<a class="headerlink" href="#feature-sigils" title="Permalink to this headline">¶</a></h3>
<p>The examples above have all just used the default sigil for the feature,
a plain box, which was all that was available in the last publicly
released standalone version of GenomeDiagram. Arrow sigils were included
when GenomeDiagram was added to Biopython 1.50:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Default uses a BOX sigil</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

<span class="c">#You can make this explicit:</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;BOX&quot;</span><span class="p">)</span>

<span class="c">#Or opt for an arrow:</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Biopython 1.61 added three more sigils,</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Box with corners cut off (making it an octagon)</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;OCTO&quot;</span><span class="p">)</span>

<span class="c">#Box with jagged edges (useful for showing breaks in contains)</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;JAGGY&quot;</span><span class="p">)</span>

<span class="c">#Arrow which spans the axis with strand used only for direction</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;BIGARROW&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>These are shown below. Most sigils fit into a bounding box (as given by
the default BOX sigil), either above or below the axis for the forward
or reverse strand, or straddling it (double the height) for strand-less
features. The BIGARROW sigil is different, always straddling the axis
with the direction taken from the feature’s stand.</p>
<p><img alt="image16" src="_images/GD_sigils.png" /></p>
</div>
<div class="section" id="arrow-sigils">
<h3>17.1.8  Arrow sigils<a class="headerlink" href="#arrow-sigils" title="Permalink to this headline">¶</a></h3>
<p>We introduced the arrow sigils in the previous section. There are two
additional options to adjust the shapes of the arrows, firstly the
thickness of the arrow shaft, given as a proportion of the height of the
bounding box:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Full height shafts, giving pointed boxes:</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;brown&quot;</span><span class="p">,</span>
                           <span class="n">arrowshaft_height</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c">#Or, thin shafts:</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;teal&quot;</span><span class="p">,</span>
                           <span class="n">arrowshaft_height</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c">#Or, very thin shafts:</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;darkgreen&quot;</span><span class="p">,</span>
                           <span class="n">arrowshaft_height</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<p>The results are shown below:</p>
<p><img alt="image17" src="_images/GD_sigil_arrow_shafts.png" /></p>
<p>Secondly, the length of the arrow head - given as a proportion of the
height of the bounding box (defaulting to 0.5, or 50%):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Short arrow heads:</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span>
                           <span class="n">arrowhead_length</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="c">#Or, longer arrow heads:</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;orange&quot;</span><span class="p">,</span>
                           <span class="n">arrowhead_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#Or, very very long arrow heads (i.e. all head, no shaft, so triangles):</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span>
                           <span class="n">arrowhead_length</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>The results are shown below:</p>
<p><img alt="image18" src="_images/GD_sigil_arrow_heads.png" /></p>
<p>Biopython 1.61 adds a new <tt class="docutils literal"><span class="pre">BIGARROW</span></tt> sigil which always stradles the
axis, pointing left for the reverse strand or right otherwise:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#A large arrow straddling the axis:</span>
<span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;BIGARROW&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>All the shaft and arrow head options shown above for the <tt class="docutils literal"><span class="pre">ARROW</span></tt> sigil
can be used for the <tt class="docutils literal"><span class="pre">BIGARROW</span></tt> sigil too.</p>
</div>
<div class="section" id="a-nice-example">
<h3>17.1.9  A nice example<a class="headerlink" href="#a-nice-example" title="Permalink to this headline">¶</a></h3>
<p>Now let’s return to the pPCP1 plasmid from <em>Yersinia pestis biovar
Microtus</em>, and the top down approach used in
Section <a class="reference external" href="#sec:gd_top_down">17.1.3</a>, but take advantage of the sigil
options we’ve now discussed. This time we’ll use arrows for the genes,
and overlay them with strand-less features (as plain boxes) showing the
position of some restriction digest sites.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">reportlab.lib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">reportlab.lib.units</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">Bio.Graphics</span> <span class="kn">import</span> <span class="n">GenomeDiagram</span>
<span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span> <span class="kn">import</span> <span class="n">SeqFeature</span><span class="p">,</span> <span class="n">FeatureLocation</span>

<span class="n">record</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;NC_005816.gb&quot;</span><span class="p">,</span> <span class="s">&quot;genbank&quot;</span><span class="p">)</span>

<span class="n">gd_diagram</span> <span class="o">=</span> <span class="n">GenomeDiagram</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">gd_track_for_features</span> <span class="o">=</span> <span class="n">gd_diagram</span><span class="o">.</span><span class="n">new_track</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Annotated Features&quot;</span><span class="p">)</span>
<span class="n">gd_feature_set</span> <span class="o">=</span> <span class="n">gd_track_for_features</span><span class="o">.</span><span class="n">new_set</span><span class="p">()</span>

<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s">&quot;gene&quot;</span><span class="p">:</span>
        <span class="c">#Exclude this feature</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gd_feature_set</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">blue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightblue</span>
    <span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">,</span>
                               <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                               <span class="n">label_size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="n">label_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c">#I want to include some strandless features, so for an example</span>
<span class="c">#will use EcoRI recognition sites etc.</span>
<span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&quot;GAATTC&quot;</span><span class="p">,</span><span class="s">&quot;EcoRI&quot;</span><span class="p">,</span><span class="n">colors</span><span class="o">.</span><span class="n">green</span><span class="p">),</span>
                          <span class="p">(</span><span class="s">&quot;CCCGGG&quot;</span><span class="p">,</span><span class="s">&quot;SmaI&quot;</span><span class="p">,</span><span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">),</span>
                          <span class="p">(</span><span class="s">&quot;AAGCTT&quot;</span><span class="p">,</span><span class="s">&quot;HindIII&quot;</span><span class="p">,</span><span class="n">colors</span><span class="o">.</span><span class="n">red</span><span class="p">),</span>
                          <span class="p">(</span><span class="s">&quot;GGATCC&quot;</span><span class="p">,</span><span class="s">&quot;BamHI&quot;</span><span class="p">,</span><span class="n">colors</span><span class="o">.</span><span class="n">purple</span><span class="p">)]:</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">index</span>  <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="k">break</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="n">SeqFeature</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">site</span><span class="p">)))</span>
        <span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                   <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label_size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                   <span class="n">label_color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>

<span class="n">gd_diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&quot;linear&quot;</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="s">&#39;A4&#39;</span><span class="p">,</span> <span class="n">fragments</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">))</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_linear_nice.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;PDF&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_linear_nice.eps&quot;</span><span class="p">,</span> <span class="s">&quot;EPS&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_linear_nice.svg&quot;</span><span class="p">,</span> <span class="s">&quot;SVG&quot;</span><span class="p">)</span>

<span class="n">gd_diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&quot;circular&quot;</span><span class="p">,</span> <span class="n">circular</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">),</span>
                <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">circle_core</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_circular_nice.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;PDF&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_circular_nice.eps&quot;</span><span class="p">,</span> <span class="s">&quot;EPS&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;plasmid_circular_nice.svg&quot;</span><span class="p">,</span> <span class="s">&quot;SVG&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And the output:</p>
<p><img alt="image19" src="_images/plasmid_linear_nice.png" /></p>
<p><img alt="image20" src="_images/plasmid_circular_nice.png" /></p>
</div>
<div class="section" id="multiple-tracks">
<h3>17.1.10  Multiple tracks<a class="headerlink" href="#multiple-tracks" title="Permalink to this headline">¶</a></h3>
<p>All the examples so far have used a single track, but you can have more
than one track – for example show the genes on one, and repeat regions
on another. In this example we’re going to show three phage genomes side
by side to scale, inspired by Figure 6 in Proux <em>e</em>t al. (2002)
[<a class="reference external" href="#proux2002">5</a>]. We’ll need the GenBank files for the following
three phage:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">NC_002703</span></tt> – Lactococcus phage Tuc2009, complete genome (38347 bp)</li>
<li><tt class="docutils literal"><span class="pre">AF323668</span></tt> – Bacteriophage bIL285, complete genome (35538 bp)</li>
<li><tt class="docutils literal"><span class="pre">NC_003212</span></tt> – <em>Listeria innocua</em> Clip11262, complete genome, of
which we are focussing only on integrated prophage 5 (similar
length).</li>
</ul>
<p>You can download these using Entrez if you like, see
Section <a class="reference external" href="#sec:efetch">9.6</a> for more details. For the third record
we’ve worked out where the phage is integrated into the genome, and
slice the record to extract it (with the features preserved, see
Section <a class="reference external" href="#sec:SeqRecord-slicing">4.6</a>), and must also reverse
complement to match the orientation of the first two phage (again
preserving the features, see
Section <a class="reference external" href="#sec:SeqRecord-reverse-complement">4.8</a>):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>

<span class="n">A_rec</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;NC_002703.gbk&quot;</span><span class="p">,</span> <span class="s">&quot;gb&quot;</span><span class="p">)</span>
<span class="n">B_rec</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;AF323668.gbk&quot;</span><span class="p">,</span> <span class="s">&quot;gb&quot;</span><span class="p">)</span>
<span class="n">C_rec</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;NC_003212.gbk&quot;</span><span class="p">,</span> <span class="s">&quot;gb&quot;</span><span class="p">)[</span><span class="mi">2587879</span><span class="p">:</span><span class="mi">2625807</span><span class="p">]</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The figure we are imitating used different colors for different gene
functions. One way to do this is to edit the GenBank file to record
color preferences for each feature - something <a class="reference external" href="http://www.sanger.ac.uk/resources/software/artemis/">Sanger’s Artemis
editor</a> does,
and which GenomeDiagram should understand. Here however, we’ll just hard
code three lists of colors.</p>
<p>Note that the annotation in the GenBank files doesn’t exactly match that
shown in Proux <em>et al.</em>, they have drawn some unannotated genes.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">reportlab.lib.colors</span> <span class="kn">import</span> <span class="n">red</span><span class="p">,</span> <span class="n">grey</span><span class="p">,</span> <span class="n">orange</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">brown</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">lightblue</span><span class="p">,</span> <span class="n">purple</span>

<span class="n">A_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">red</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span><span class="o">*</span><span class="mi">7</span> <span class="o">+</span> <span class="p">[</span><span class="n">orange</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">orange</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span><span class="o">*</span><span class="mi">11</span> <span class="o">+</span> <span class="p">[</span><span class="n">green</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> \
         <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">green</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">,</span> <span class="n">green</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">brown</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="n">blue</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="p">[</span><span class="n">lightblue</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> \
         <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">,</span> <span class="n">lightblue</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">purple</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span>
<span class="n">B_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">red</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span> <span class="o">+</span> <span class="p">[</span><span class="n">orange</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">orange</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span><span class="o">*</span><span class="mi">21</span> <span class="o">+</span> <span class="p">[</span><span class="n">green</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> \
         <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">brown</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="p">[</span><span class="n">blue</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="n">lightblue</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="n">purple</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">C_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span><span class="o">*</span><span class="mi">30</span> <span class="o">+</span> <span class="p">[</span><span class="n">green</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="n">brown</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="p">[</span><span class="n">blue</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">,</span> <span class="n">blue</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">lightblue</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> \
         <span class="o">+</span> <span class="p">[</span><span class="n">grey</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
</pre></div>
</div>
<p>Now to draw them – this time we add three tracks to the diagram, and
also notice they are given different start/end values to reflect their
different lengths (this requires Biopython 1.59 or later).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio.Graphics</span> <span class="kn">import</span> <span class="n">GenomeDiagram</span>

<span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Proux Fig 6&quot;</span>
<span class="n">gd_diagram</span> <span class="o">=</span> <span class="n">GenomeDiagram</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="n">max_len</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">record</span><span class="p">,</span> <span class="n">gene_colors</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">A_rec</span><span class="p">,</span> <span class="n">B_rec</span><span class="p">,</span> <span class="n">C_rec</span><span class="p">],</span> <span class="p">[</span><span class="n">A_colors</span><span class="p">,</span> <span class="n">B_colors</span><span class="p">,</span> <span class="n">C_colors</span><span class="p">]):</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">))</span>
    <span class="n">gd_track_for_features</span> <span class="o">=</span> <span class="n">gd_diagram</span><span class="o">.</span><span class="n">new_track</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">greytrack</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">))</span>
    <span class="n">gd_feature_set</span> <span class="o">=</span> <span class="n">gd_track_for_features</span><span class="o">.</span><span class="n">new_set</span><span class="p">()</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s">&quot;gene&quot;</span><span class="p">:</span>
            <span class="c">#Exclude this feature</span>
            <span class="k">continue</span>
        <span class="n">gd_feature_set</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">sigil</span><span class="o">=</span><span class="s">&quot;ARROW&quot;</span><span class="p">,</span>
                                   <span class="n">color</span><span class="o">=</span><span class="n">gene_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                   <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                   <span class="n">label_position</span><span class="o">=</span><span class="s">&quot;start&quot;</span><span class="p">,</span>
                                   <span class="n">label_size</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">label_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

<span class="n">gd_diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&quot;linear&quot;</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="s">&#39;A4&#39;</span><span class="p">,</span> <span class="n">fragments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">max_len</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;PDF&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.eps&quot;</span><span class="p">,</span> <span class="s">&quot;EPS&quot;</span><span class="p">)</span>
<span class="n">gd_diagram</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.svg&quot;</span><span class="p">,</span> <span class="s">&quot;SVG&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The result:</p>
<p><img alt="image21" src="_images/three_track_simple.png" /></p>
<p>I did wonder why in the original manuscript there were no red or orange
genes marked in the bottom phage. Another important point is here the
phage are shown with different lengths - this is because they are all
drawn to the same scale (they <em>are</em> different lengths).</p>
<p>The key difference from the published figure is they have color-coded
links between similar proteins – which is what we will do in the next
section.</p>
</div>
<div class="section" id="cross-links-between-tracks">
<h3>17.1.11  Cross-Links between tracks<a class="headerlink" href="#cross-links-between-tracks" title="Permalink to this headline">¶</a></h3>
<p>Biopython 1.59 added the ability to draw cross links between tracks -
both simple linear diagrams as we will show here, but also linear
diagrams split into fragments and circular diagrams.</p>
<p>Continuing the example from the previous section inspired by Figure 6
from Proux <em>et al.</em> 2002 [<a class="reference external" href="#proux2002">5</a>], we would need a list of
cross links between pairs of genes, along with a score or color to use.
Realistically you might extract this from a BLAST file computationally,
but here I have manually typed them in.</p>
<p>My naming convention continues to refer to the three phage as A, B and
C. Here are the links we want to show between A and B, given as a list
of tuples (percentage similarity score, gene in A, gene in B).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Tuc2009 (NC_002703) vs bIL285 (AF323668)</span>
<span class="n">A_vs_B</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="s">&quot;Tuc2009_01&quot;</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="s">&quot;Tuc2009_03&quot;</span><span class="p">,</span> <span class="s">&quot;orf4&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="s">&quot;Tuc2009_05&quot;</span><span class="p">,</span> <span class="s">&quot;orf6&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="s">&quot;Tuc2009_06&quot;</span><span class="p">,</span> <span class="s">&quot;orf7&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s">&quot;Tuc2009_07&quot;</span><span class="p">,</span> <span class="s">&quot;orf8&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="s">&quot;Tuc2009_08&quot;</span><span class="p">,</span> <span class="s">&quot;orf9&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="s">&quot;Tuc2009_09&quot;</span><span class="p">,</span> <span class="s">&quot;orf10&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="s">&quot;Tuc2009_10&quot;</span><span class="p">,</span> <span class="s">&quot;orf12&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="s">&quot;Tuc2009_11&quot;</span><span class="p">,</span> <span class="s">&quot;orf13&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="s">&quot;Tuc2009_12&quot;</span><span class="p">,</span> <span class="s">&quot;orf14&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="s">&quot;Tuc2009_13&quot;</span><span class="p">,</span> <span class="s">&quot;orf15&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="s">&quot;Tuc2009_14&quot;</span><span class="p">,</span> <span class="s">&quot;orf16&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="s">&quot;Tuc2009_15&quot;</span><span class="p">,</span> <span class="s">&quot;orf17&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">88</span><span class="p">,</span> <span class="s">&quot;Tuc2009_17&quot;</span><span class="p">,</span> <span class="s">&quot;rusA&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">91</span><span class="p">,</span> <span class="s">&quot;Tuc2009_18&quot;</span><span class="p">,</span> <span class="s">&quot;orf20&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">93</span><span class="p">,</span> <span class="s">&quot;Tuc2009_19&quot;</span><span class="p">,</span> <span class="s">&quot;orf22&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">71</span><span class="p">,</span> <span class="s">&quot;Tuc2009_20&quot;</span><span class="p">,</span> <span class="s">&quot;orf23&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="s">&quot;Tuc2009_22&quot;</span><span class="p">,</span> <span class="s">&quot;orf27&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s">&quot;Tuc2009_23&quot;</span><span class="p">,</span> <span class="s">&quot;orf28&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">88</span><span class="p">,</span> <span class="s">&quot;Tuc2009_24&quot;</span><span class="p">,</span> <span class="s">&quot;orf29&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="s">&quot;Tuc2009_26&quot;</span><span class="p">,</span> <span class="s">&quot;orf38&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="s">&quot;Tuc2009_46&quot;</span><span class="p">,</span> <span class="s">&quot;orf52&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">77</span><span class="p">,</span> <span class="s">&quot;Tuc2009_48&quot;</span><span class="p">,</span> <span class="s">&quot;orf54&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">91</span><span class="p">,</span> <span class="s">&quot;Tuc2009_49&quot;</span><span class="p">,</span> <span class="s">&quot;orf55&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="s">&quot;Tuc2009_52&quot;</span><span class="p">,</span> <span class="s">&quot;orf60&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Likewise for B and C:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#bIL285 (AF323668) vs Listeria innocua prophage 5 (in NC_003212)</span>
<span class="n">B_vs_C</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s">&quot;orf39&quot;</span><span class="p">,</span> <span class="s">&quot;lin2581&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="s">&quot;orf40&quot;</span><span class="p">,</span> <span class="s">&quot;lin2580&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="s">&quot;orf41&quot;</span><span class="p">,</span> <span class="s">&quot;lin2579&quot;</span><span class="p">),</span> <span class="c">#terL</span>
    <span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="s">&quot;orf42&quot;</span><span class="p">,</span> <span class="s">&quot;lin2578&quot;</span><span class="p">),</span> <span class="c">#portal</span>
    <span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="s">&quot;orf43&quot;</span><span class="p">,</span> <span class="s">&quot;lin2577&quot;</span><span class="p">),</span> <span class="c">#protease</span>
    <span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="s">&quot;orf44&quot;</span><span class="p">,</span> <span class="s">&quot;lin2576&quot;</span><span class="p">),</span> <span class="c">#mhp</span>
    <span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="s">&quot;orf46&quot;</span><span class="p">,</span> <span class="s">&quot;lin2575&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="s">&quot;orf47&quot;</span><span class="p">,</span> <span class="s">&quot;lin2574&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="s">&quot;orf48&quot;</span><span class="p">,</span> <span class="s">&quot;lin2573&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="s">&quot;orf49&quot;</span><span class="p">,</span> <span class="s">&quot;lin2572&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s">&quot;orf50&quot;</span><span class="p">,</span> <span class="s">&quot;lin2571&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="s">&quot;orf51&quot;</span><span class="p">,</span> <span class="s">&quot;lin2570&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="s">&quot;orf52&quot;</span><span class="p">,</span> <span class="s">&quot;lin2568&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s">&quot;orf53&quot;</span><span class="p">,</span> <span class="s">&quot;lin2567&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="s">&quot;orf54&quot;</span><span class="p">,</span> <span class="s">&quot;lin2566&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>For the first and last phage these identifiers are locus tags, for the
middle phage there are no locus tags so I’ve used gene names instead.
The following little helper function lets us lookup a feature using
either a locus tag or gene name:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_feature</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;locus_tag&quot;</span><span class="p">,</span> <span class="s">&quot;gene&quot;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Search list of SeqFeature objects for an identifier under the given tags.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="c">#tag may not be present in this feature</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">qualifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                     <span class="k">return</span> <span class="n">f</span>
    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now turn those list of identifier pairs into SeqFeature pairs,
and thus find their location co-ordinates. We can now add all that code
and the following snippet to the previous example (just before the
<tt class="docutils literal"><span class="pre">gd_diagram.draw(...)</span></tt> line – see the finished example script
<a class="reference external" href="http://biopython.org/SRC/biopython/Doc/examples/Proux_et_al_2002_Figure_6.py">Proux_et_al_2002_Figure_6.py</a>
included in the <tt class="docutils literal"><span class="pre">Doc/examples</span></tt> folder of the Biopython source code) to
add cross links to the figure:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio.Graphics.GenomeDiagram</span> <span class="kn">import</span> <span class="n">CrossLink</span>
<span class="kn">from</span> <span class="nn">reportlab.lib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="c">#Note it might have been clearer to assign the track numbers explicitly...</span>
<span class="k">for</span> <span class="n">rec_X</span><span class="p">,</span> <span class="n">tn_X</span><span class="p">,</span> <span class="n">rec_Y</span><span class="p">,</span> <span class="n">tn_Y</span><span class="p">,</span> <span class="n">X_vs_Y</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">A_rec</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">B_rec</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">A_vs_B</span><span class="p">),</span>
                                         <span class="p">(</span><span class="n">B_rec</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">C_rec</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">B_vs_C</span><span class="p">)]:</span>
    <span class="n">track_X</span> <span class="o">=</span> <span class="n">gd_diagram</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">tn_X</span><span class="p">]</span>
    <span class="n">track_Y</span> <span class="o">=</span> <span class="n">gd_diagram</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">tn_Y</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">id_X</span><span class="p">,</span> <span class="n">id_Y</span> <span class="ow">in</span> <span class="n">X_vs_Y</span><span class="p">:</span>
        <span class="n">feature_X</span> <span class="o">=</span> <span class="n">get_feature</span><span class="p">(</span><span class="n">rec_X</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">id_X</span><span class="p">)</span>
        <span class="n">feature_Y</span> <span class="o">=</span> <span class="n">get_feature</span><span class="p">(</span><span class="n">rec_Y</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">id_Y</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">linearlyInterpolatedColor</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">white</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">firebrick</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
        <span class="n">link_xy</span> <span class="o">=</span> <span class="n">CrossLink</span><span class="p">((</span><span class="n">track_X</span><span class="p">,</span> <span class="n">feature_X</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">feature_X</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">track_Y</span><span class="p">,</span> <span class="n">feature_Y</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">feature_Y</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">),</span>
                            <span class="n">color</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span><span class="p">)</span>
        <span class="n">gd_diagram</span><span class="o">.</span><span class="n">cross_track_links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_xy</span><span class="p">)</span>
</pre></div>
</div>
<p>There are several important pieces to this code. First the
<tt class="docutils literal"><span class="pre">GenomeDiagram</span></tt> object has a <tt class="docutils literal"><span class="pre">cross_track_links</span></tt> attribute which is
just a list of <tt class="docutils literal"><span class="pre">CrossLink</span></tt> objects. Each <tt class="docutils literal"><span class="pre">CrossLink</span></tt> object takes
two sets of track-specific co-ordinates (here given as tuples, you can
alternatively use a <tt class="docutils literal"><span class="pre">GenomeDiagram.Feature</span></tt> object instead). You can
optionally supply a colour, border color, and say if this link should be
drawn flipped (useful for showing inversions).</p>
<p>You can also see how we turn the BLAST percentage identity score into a
colour, interpolating between white (0%) and a dark red (100%). In this
example we don’t have any problems with overlapping cross-links. One way
to tackle that is to use transparency in ReportLab, by using colors with
their alpha channel set. However, this kind of shaded color scheme
combined with overlap transparency would be difficult to interpret. The
result:</p>
<p><img alt="image22" src="_images/three_track_cl.png" /></p>
<p>There is still a lot more that can be done within Biopython to help
improve this figure. First of all, the cross links in this case are
between proteins which are drawn in a strand specific manor. It can help
to add a background region (a feature using the ‘BOX’ sigil) on the
feature track to extend the cross link. Also, we could reduce the
vertical height of the feature tracks to allocate more to the links
instead – one way to do that is to allocate space for empty tracks.
Furthermore, in cases like this where there are no large gene overlaps,
we can use the axis-straddling <tt class="docutils literal"><span class="pre">BIGARROW</span></tt> sigil, which allows us to
further reduce the vertical space needed for the track. These
improvements are demonstrated in the example script
<a class="reference external" href="http://biopython.org/SRC/biopython/Doc/examples/Proux_et_al_2002_Figure_6.py">Proux_et_al_2002_Figure_6.py</a>
included in the <tt class="docutils literal"><span class="pre">Doc/examples</span></tt> folder of the Biopython source code.
The result:</p>
<p><img alt="image23" src="_images/three_track_cl2a.png" /></p>
<p>Beyond that, finishing touches you might want to do manually in a vector
image editor include fine tuning the placement of gene labels, and
adding other custom annotation such as highlighting particular regions.</p>
<p>Although not really necessary in this example since none of the
cross-links overlap, using a transparent color in ReportLab is a very
useful technique for superimposing multiple links. However, in this case
a shaded color scheme should be avoided.</p>
</div>
<div class="section" id="further-options">
<h3>17.1.12  Further options<a class="headerlink" href="#further-options" title="Permalink to this headline">¶</a></h3>
<p>You can control the tick marks to show the scale – after all every graph
should show its units, and the number of the grey-track labels.</p>
<p>Also, we have only used the <tt class="docutils literal"><span class="pre">FeatureSet</span></tt> so far. GenomeDiagram also
has a <tt class="docutils literal"><span class="pre">GraphSet</span></tt> which can be used for show line graphs, bar charts
and heat plots (e.g. to show plots of GC% on a track parallel to the
features).</p>
<p>These options are not covered here yet, so for now we refer you to the
<a class="reference external" href="http://biopython.org/DIST/docs/GenomeDiagram/userguide.pdf">User Guide
(PDF)</a>
included with the standalone version of GenomeDiagram (but please read
the next section first), and the docstrings.</p>
</div>
<div class="section" id="converting-old-code">
<h3>17.1.13  Converting old code<a class="headerlink" href="#converting-old-code" title="Permalink to this headline">¶</a></h3>
<p>If you have old code written using the standalone version of
GenomeDiagram, and you want to switch it over to using the new version
included with Biopython then you will have to make a few changes - most
importantly to your import statements.</p>
<p>Also, the older version of GenomeDiagram used only the UK spellings of
color and center (colour and centre). As part of the integration into
Biopython, both forms can now be used for argument names. However, at
some point in the future the UK spellings may be deprecated.</p>
<p>For example, if you used to have:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">GenomeDiagram</span> <span class="kn">import</span> <span class="n">GDFeatureSet</span><span class="p">,</span> <span class="n">GDDiagram</span>
<span class="n">gdd</span> <span class="o">=</span> <span class="n">GDDiagram</span><span class="p">(</span><span class="s">&quot;An example&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>you could just switch the import statements like this:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio.Graphics.GenomeDiagram</span> <span class="kn">import</span> <span class="n">FeatureSet</span> <span class="k">as</span> <span class="n">GDFeatureSet</span><span class="p">,</span> <span class="n">Diagram</span> <span class="k">as</span> <span class="n">GDDiagram</span>
<span class="n">gdd</span> <span class="o">=</span> <span class="n">GDDiagram</span><span class="p">(</span><span class="s">&quot;An example&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>and hopefully that should be enough. In the long term you might want to
switch to the new names, but you would have to change more of your code:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio.Graphics.GenomeDiagram</span> <span class="kn">import</span> <span class="n">FeatureSet</span><span class="p">,</span> <span class="n">Diagram</span>
<span class="n">gdd</span> <span class="o">=</span> <span class="n">Diagram</span><span class="p">(</span><span class="s">&quot;An example&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>or:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio.Graphics</span> <span class="kn">import</span> <span class="n">GenomeDiagram</span>
<span class="n">gdd</span> <span class="o">=</span> <span class="n">GenomeDiagram</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="s">&quot;An example&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If you run into difficulties, please ask on the Biopython mailing list
for advice. One catch is that we have not included the old module
<tt class="docutils literal"><span class="pre">GenomeDiagram.GDUtilities</span></tt> yet. This included a number of GC% related
functions, which will probably be merged under <tt class="docutils literal"><span class="pre">Bio.SeqUtils</span></tt> later
on.</p>
</div>
</div>
<div class="section" id="chromosomes">
<h2>17.2  Chromosomes<a class="headerlink" href="#chromosomes" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">Bio.Graphics.BasicChromosome</span></tt> module allows drawing of
chromosomes. There is an example in Jupe <em>et al.</em> (2012)
[<a class="reference external" href="#jupe2012">6</a>] (open access) using colors to highlight different
gene families.</p>
<div class="section" id="simple-chromosomes">
<h3>17.2.1  Simple Chromosomes<a class="headerlink" href="#simple-chromosomes" title="Permalink to this headline">¶</a></h3>
<p>Here is a very simple example - for which we’ll use <em>Arabidopsis
thaliana</em>.</p>
<p>You can skip this bit, but first I downloaded the five sequenced
chromosomes from the NCBI’s FTP site
<a class="reference external" href="ftp://ftp.ncbi.nlm.nih.gov/genomes/Arabidopsis_thaliana">ftp://ftp.ncbi.nlm.nih.gov/genomes/Arabidopsis_thaliana</a>
and then parsed them with <tt class="docutils literal"><span class="pre">Bio.SeqIO</span></tt> to find out their lengths. You
could use the GenBank files for this, but it is faster to use the FASTA
files for the whole chromosomes:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
<span class="n">entries</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;Chr I&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_I/NC_003070.fna&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr II&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_II/NC_003071.fna&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr III&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_III/NC_003074.fna&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr IV&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_IV/NC_003075.fna&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr V&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_V/NC_003076.fna&quot;</span><span class="p">)]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
   <span class="n">record</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot;fasta&quot;</span><span class="p">)</span>
   <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</pre></div>
</div>
<p>This gave the lengths of the five chromosomes, which we’ll now use in
the following short demonstration of the <tt class="docutils literal"><span class="pre">BasicChromosome</span></tt> module:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">reportlab.lib.units</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">Bio.Graphics</span> <span class="kn">import</span> <span class="n">BasicChromosome</span>

<span class="n">entries</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;Chr I&quot;</span><span class="p">,</span> <span class="mi">30432563</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr II&quot;</span><span class="p">,</span> <span class="mi">19705359</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr III&quot;</span><span class="p">,</span> <span class="mi">23470805</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr IV&quot;</span><span class="p">,</span> <span class="mi">18585042</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr V&quot;</span><span class="p">,</span> <span class="mi">26992728</span><span class="p">)]</span>

<span class="n">max_len</span> <span class="o">=</span> <span class="mi">30432563</span> <span class="c">#Could compute this</span>
<span class="n">telomere_length</span> <span class="o">=</span> <span class="mi">1000000</span> <span class="c">#For illustration</span>

<span class="n">chr_diagram</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">Organism</span><span class="p">()</span>
<span class="n">chr_diagram</span><span class="o">.</span><span class="n">page_size</span> <span class="o">=</span> <span class="p">(</span><span class="mf">29.7</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mi">21</span><span class="o">*</span><span class="n">cm</span><span class="p">)</span> <span class="c">#A4 landscape</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
    <span class="n">cur_chromosome</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">Chromosome</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c">#Set the scale to the MAXIMUM length plus the two telomeres in bp,</span>
    <span class="c">#want the same scale used on all five chromosomes so they can be</span>
    <span class="c">#compared to each other</span>
    <span class="n">cur_chromosome</span><span class="o">.</span><span class="n">scale_num</span> <span class="o">=</span> <span class="n">max_len</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">telomere_length</span>

    <span class="c">#Add an opening telomere</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">TelomereSegment</span><span class="p">()</span>
    <span class="n">start</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">telomere_length</span>
    <span class="n">cur_chromosome</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

    <span class="c">#Add a body - using bp as the scale length here.</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">ChromosomeSegment</span><span class="p">()</span>
    <span class="n">body</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">length</span>
    <span class="n">cur_chromosome</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

    <span class="c">#Add a closing telomere</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">TelomereSegment</span><span class="p">(</span><span class="n">inverted</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">end</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">telomere_length</span>
    <span class="n">cur_chromosome</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

    <span class="c">#This chromosome is done</span>
    <span class="n">chr_diagram</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cur_chromosome</span><span class="p">)</span>

<span class="n">chr_diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s">&quot;simple_chrom.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;Arabidopsis thaliana&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This should create a very simple PDF file, shown here:</p>
<p><img alt="image24" src="_images/simple_chrom.png" /></p>
<p>This example is deliberately short and sweet. The next example shows the
location of features of interest.</p>
</div>
<div class="section" id="annotated-chromosomes">
<h3>17.2.2  Annotated Chromosomes<a class="headerlink" href="#annotated-chromosomes" title="Permalink to this headline">¶</a></h3>
<p>Continuing from the previous example, let’s also show the tRNA genes.
We’ll get their locations by parsing the GenBank files for the five
<em>Arabidopsis thaliana</em> chromosomes. You’ll need to download these files
from the NCBI FTP site
<a class="reference external" href="ftp://ftp.ncbi.nlm.nih.gov/genomes/Arabidopsis_thaliana">ftp://ftp.ncbi.nlm.nih.gov/genomes/Arabidopsis_thaliana</a>,
and preserve the subdirectory names or edit the paths below:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">reportlab.lib.units</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
<span class="kn">from</span> <span class="nn">Bio.Graphics</span> <span class="kn">import</span> <span class="n">BasicChromosome</span>

<span class="n">entries</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;Chr I&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_I/NC_003070.gbk&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr II&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_II/NC_003071.gbk&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr III&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_III/NC_003074.gbk&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr IV&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_IV/NC_003075.gbk&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&quot;Chr V&quot;</span><span class="p">,</span> <span class="s">&quot;CHR_V/NC_003076.gbk&quot;</span><span class="p">)]</span>

<span class="n">max_len</span> <span class="o">=</span> <span class="mi">30432563</span> <span class="c">#Could compute this</span>
<span class="n">telomere_length</span> <span class="o">=</span> <span class="mi">1000000</span> <span class="c">#For illustration</span>

<span class="n">chr_diagram</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">Organism</span><span class="p">()</span>
<span class="n">chr_diagram</span><span class="o">.</span><span class="n">page_size</span> <span class="o">=</span> <span class="p">(</span><span class="mf">29.7</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mi">21</span><span class="o">*</span><span class="n">cm</span><span class="p">)</span> <span class="c">#A4 landscape</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot;genbank&quot;</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">type</span><span class="o">==</span><span class="s">&quot;tRNA&quot;</span><span class="p">]</span>
    <span class="c">#Record an Artemis style integer color in the feature&#39;s qualifiers,</span>
    <span class="c">#1 = Black, 2 = Red, 3 = Green, 4 = blue, 5 =cyan, 6 = purple</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">cur_chromosome</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">Chromosome</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c">#Set the scale to the MAXIMUM length plus the two telomeres in bp,</span>
    <span class="c">#want the same scale used on all five chromosomes so they can be</span>
    <span class="c">#compared to each other</span>
    <span class="n">cur_chromosome</span><span class="o">.</span><span class="n">scale_num</span> <span class="o">=</span> <span class="n">max_len</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">telomere_length</span>

    <span class="c">#Add an opening telomere</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">TelomereSegment</span><span class="p">()</span>
    <span class="n">start</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">telomere_length</span>
    <span class="n">cur_chromosome</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

    <span class="c">#Add a body - again using bp as the scale length here.</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">AnnotatedChromosomeSegment</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
    <span class="n">body</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">length</span>
    <span class="n">cur_chromosome</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

    <span class="c">#Add a closing telomere</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">BasicChromosome</span><span class="o">.</span><span class="n">TelomereSegment</span><span class="p">(</span><span class="n">inverted</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">end</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">telomere_length</span>
    <span class="n">cur_chromosome</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

    <span class="c">#This chromosome is done</span>
    <span class="n">chr_diagram</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cur_chromosome</span><span class="p">)</span>

<span class="n">chr_diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s">&quot;tRNA_chrom.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;Arabidopsis thaliana&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It might warn you about the labels being too close together - have a
look at the forward strand (right hand side) of Chr I, but it should
create a colorful PDF file, shown here:</p>
<p><img alt="image25" src="_images/tRNA_chrom.png" /></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Chapter 17  Graphics including GenomeDiagram</a><ul>
<li><a class="reference internal" href="#genomediagram">17.1  GenomeDiagram</a><ul>
<li><a class="reference internal" href="#introduction">17.1.1  Introduction</a></li>
<li><a class="reference internal" href="#diagrams-tracks-feature-sets-and-features">17.1.2  Diagrams, tracks, feature-sets and features</a></li>
<li><a class="reference internal" href="#a-top-down-example">17.1.3  A top down example</a></li>
<li><a class="reference internal" href="#a-bottom-up-example">17.1.4  A bottom up example</a></li>
<li><a class="reference internal" href="#features-without-a-seqfeature">17.1.5  Features without a SeqFeature</a></li>
<li><a class="reference internal" href="#feature-captions">17.1.6  Feature captions</a></li>
<li><a class="reference internal" href="#feature-sigils">17.1.7  Feature sigils</a></li>
<li><a class="reference internal" href="#arrow-sigils">17.1.8  Arrow sigils</a></li>
<li><a class="reference internal" href="#a-nice-example">17.1.9  A nice example</a></li>
<li><a class="reference internal" href="#multiple-tracks">17.1.10  Multiple tracks</a></li>
<li><a class="reference internal" href="#cross-links-between-tracks">17.1.11  Cross-Links between tracks</a></li>
<li><a class="reference internal" href="#further-options">17.1.12  Further options</a></li>
<li><a class="reference internal" href="#converting-old-code">17.1.13  Converting old code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chromosomes">17.2  Chromosomes</a><ul>
<li><a class="reference internal" href="#simple-chromosomes">17.2.1  Simple Chromosomes</a></li>
<li><a class="reference internal" href="#annotated-chromosomes">17.2.2  Annotated Chromosomes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="chr16.html"
                        title="previous chapter">Chapter 16  Supervised learning methods</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="chr18.html"
                        title="next chapter">Chapter 18  Cookbook – Cool things to do with it</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/chr17.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="chr18.html" title="Chapter 18 Cookbook – Cool things to do with it"
             >next</a> |</li>
        <li class="right" >
          <a href="chr16.html" title="Chapter 16 Supervised learning methods"
             >previous</a> |</li>
        <li><a href="index.html">biopython_en 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, biopythoners.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>